#!/usr/bin/env bash
# with-packages nix-wrapped cachix loop
set -x
rev=${1:-main}
output=${2:-homeConfigurations.$HOSTNAME}
link=/tmp/${output}_${rev}
loop -n3 -- nix build --tarball-ttl 0 -o $link github:kwbauson/cfg?ref=$rev#$output
status=$?
cachix push kwbauson $link
exit $status
